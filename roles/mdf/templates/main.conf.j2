{# this generates MDF specific config. It will be merged with the config generated by the common role before it is applied to the MDF #}
# *** MDF CONFIGUATION ***

{# TACACS #}
{% for tac_params in mdf.tacacs.servers %}
{% set prefx = 'set system tacplus-server ' +  tac_params.ip %}
{{ prefx }} secret "{{ tac_params.secret }}"
{{ prefx }} source-address {{ tac_params.src_addr }}
{% endfor %}

{# HELPER FOR DNS #}
set forwarding-options helpers domain server {{ helpers.domain_server }}

{# HELPERS FOR DHCP #}
{% for mygroup in helpers.dhcp.server_group %}
{% set prefx = 'set forwarding-options dhcp-relay server-group ' + mygroup.name %}
{% for myserver in mygroup.servers %} 
{{ prefx }} {{ myserver }}
{% endfor %}
{% if mygroup.active %}
set forwarding-options dhcp-relay active-server-group {{ mygroup.name }}
{% endif %}
{% endfor %}
{% for sitevlan in site_vlans %}
{% set prefx = 'set forwarding-options dhcp-relay group Server_Group interface' %}
{% if sitevlan.dhcp %}
{% if "EX4300" in model %}
{{ prefx }} irb.{{ sitevlan.id }}
{% else %}
{{ prefx }} vlan.{{ sitevlan.id }}
{% endif %}
{% endif %}
{% endfor %}

